@model   EasyCms.Web.DialogModel
@*标题 界面 多选 单选 新原的值是追加还是覆盖（多选时）  是否是树结构  ，选择结果事件  取消关闭事件，对应的url*@
@using EasyCms.Web
@{string btnOkID = "tnOk" + Guid.NewGuid();}
<div id="@Model.DialogID">
    <div>
        <span>

            @HelperExtend.img("help.png")   @Model.Title
        </span>
    </div>
    <div>
        <div class="mainSplitter">
            <div class="splitter-panel">
               
                <div id="@Model.DataControlID">
                </div>
                @if (Model.IsMutiSelect)
                {
                    <text> 按住Ctrl 或Shift可以多选</text>
                }
            </div>
            <div class="splitter-panel">
               
                <div class="btn-wrap" style="margin:2px auto; text-align:center">
                   
                    <input id="@btnOkID" type="button" value="确定" class="btn" onclick="javascript: @Model.OnOk;$('#@Model.DialogID').jqxWindow('close');" />
                    <input name="btnReturn" type="button" value="取消" class="btn yellow" onclick="javascript: $('#@Model.DialogID').jqxWindow('close');" />
                </div>

            </div>
        </div>
    </div>
</div>
<script type="text/javascript">

    $(function () {
        $('#@Model.DialogID').jqxWindow({autoOpen: false, resizable: true,  isModal: true,initContent: @Model.InnitFunc,
            showCollapseButton: false, maxHeight: 900, maxWidth: 1000, minHeight: 100, minWidth: 200, height: @Model.Height , width: @Model.Width
            });
        $('#@Model.DialogID').find(".mainSplitter").jqxSplitter({ width: "100%", height:"99%",
            splitBarSize: 0,showSplitBar: true ,    orientation: 'horizontal', panels: [{   size:"90%",collapsed:false }, { size:"5%" ,collapsed:false}] });
        $('#@btnOkID').click(function(){
            var result;

            if (@Model.IsTree.ToString().ToLower() ) {
                if (@Model.IsMutiSelect.ToString().ToLower() ) {
                result = $("#@Model.DataControlID").jqxTreeGrid('getSelection');

            }else
            {
                result = $("#@Model.DataControlID").jqxTreeGrid('getSelection');

            }
        }else
    {
         if (@Model.IsMutiSelect.ToString().ToLower() ) {
        result =$("#@Model.DataControlID").jqxGrid('getselectedrowindexes');
        var arryval=new   Array ();
        for (var i  in result)
        {
            arryval.push(  $('#@Model.DataControlID').jqxGrid('getrowdata', result[i]));
        }
        result=arryval;

    }else
    {
      result =$("#@Model.DataControlID").jqxGrid('getselectedrowindex');
    result = $('#@Model.DataControlID').jqxGrid('getrowdata', result);

    }
    }
    @{@Model.OnOk}(result);

    });
    });



</script>










@helper HelpEdit(string url,string id, string code, string name, string defaultVal = null, string defaultText = null, string hint = "",  int width = 200,
                    string dialogTitle = "", int dialogWidth = 500, int dialogHeight = 500, string DataControlID = "dataGrid",
                        bool IsMutiSelect = false, bool IsTree = false, bool IsHidButton = false, string OnClose = "OnClose",, string OnGetUrl= "OnGetUrl")
{
    string dialogID = code + Guid.NewGuid();
    string selectButtonID = code + Guid.NewGuid();
    string OnBeforeFunc = "isContienu=" + OnBefore + "();";
    <dl>
        <dt>
            @MVCExtention.ExtendHtmlInput.MvcHelper.Label(code, name)
            @MVCExtention.ExtendHtmlInput.MvcHelper.Hidden(id, defaultVal)


        </dt>
        <dd>
            @MVCExtention.ExtendHtmlInput.MvcHelper.TextBox(code, defaultText, new { @class = "input normal " + otherClass, width = width, @readonly = "readonly" })

            @if (!IsHidButton)
            {


                <span class="input-group-btn">

                    <button class="btn blue btnHelp" id="@selectButtonID">
                        选择
                    </button>
                    <button class="btn yellow btnHelp" onclick="javascript: $('#@id').val(''); $('#@code').val('');return false;">
                        清除选择
                    </button>
                </span>
            }
            <span style="color:red">@MVCExtention.ExtendHtmlInput.MvcHelper.Raw(hint)</span>

        </dd>
    </dl>
    <script type="text/javascript">

        $(function () {

            $("#@selectButtonID").click(function () {
                var isContienu=true;
                @if (!string.IsNullOrWhiteSpace(OnBefore))
	{
                     @OnBeforeFunc
	}
                if (isContienu) {
                    $("#@dialogID").jqxWindow('open');

                }
                return false;
            });

        });
    </script>

    @MVCExtention.ExtendHtmlInput.MvcHelper.Partial("_Dialog", new EasyCms.Web.DialogModel
{
    DialogID = dialogID,
    Title = dialogTitle,
    Height = dialogHeight,
    Width = dialogWidth,
    InnitFunc = InnitFunc,
    OnOk = onOk,
    DataControlID = DataControlID,
    IsMutiSelect = IsMutiSelect,
    IsTree = IsTree
})
}
